<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Chris Hager"><meta name=description content="This post is about the paper &ldquo;Improving security for users of decentralized exchanges through multiparty computation&rdquo;, by Robert Annessi and Ethan Fast.
The paper introduces an effective algorithm for secure, collaborative signature generation using threshold signatures, and an API-key based client/server protocol that allows user-specific limits and restrictions as well as key revocations and rotations.
The method supports all blockchains that use ECDSA and EdDSA signatures, which includes Bitcoin, Ethereum and the majority of popular cryptocurrencies."><meta name=keywords content="Blockchain ,Ethereum ,MPC ,Cryptography ,Threshold signatures"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.metachris.dev/images/posts/mpc/og.jpg"><meta name=twitter:title content="Securing private keys with a high-performance, threshold signature-based protocol"><meta name=twitter:description content="This post is about the paper &ldquo;Improving security for users of decentralized exchanges through multiparty computation&rdquo;, by Robert Annessi and Ethan Fast.
The paper introduces an effective algorithm for secure, collaborative signature generation using threshold signatures, and an API-key based client/server protocol that allows user-specific limits and restrictions as well as key revocations and rotations.
The method supports all blockchains that use ECDSA and EdDSA signatures, which includes Bitcoin, Ethereum and the majority of popular cryptocurrencies."><meta property="og:title" content="Securing private keys with a high-performance, threshold signature-based protocol"><meta property="og:description" content="This post is about the paper &ldquo;Improving security for users of decentralized exchanges through multiparty computation&rdquo;, by Robert Annessi and Ethan Fast.
The paper introduces an effective algorithm for secure, collaborative signature generation using threshold signatures, and an API-key based client/server protocol that allows user-specific limits and restrictions as well as key revocations and rotations.
The method supports all blockchains that use ECDSA and EdDSA signatures, which includes Bitcoin, Ethereum and the majority of popular cryptocurrencies."><meta property="og:type" content="article"><meta property="og:url" content="https://www.metachris.dev/2021/07/securing-private-keys-with-a-high-performance-threshold-signature-based-protocol/"><meta property="og:image" content="https://www.metachris.dev/images/posts/mpc/og.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-21T00:00:00+00:00"><meta property="article:modified_time" content="2021-07-21T00:00:00+00:00"><base href=https://www.metachris.dev/2021/07/securing-private-keys-with-a-high-performance-threshold-signature-based-protocol/><title>Securing private keys with a high-performance, threshold signature-based protocol Â· Chris Hager
</title><link rel=canonical href=https://www.metachris.dev/2021/07/securing-private-keys-with-a-high-performance-threshold-signature-based-protocol/><link rel=stylesheet href=https://www.metachris.dev/css/normalize.min.css><link rel=stylesheet href=https://www.metachris.dev/css/coder.min.b264ded956f78952483311122dc15a4f063ddb1a48c781695b2374838257e557.css integrity="sha256-smTe2Vb3iVJIMxESLcFaTwY92xpIx4FpWyN0g4JX5Vc=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://www.metachris.dev/css/coder-dark.min.47e2bf508bd8d2609f50751fec4e8bea1d7d66645d0a2fb25c4a43f5ecac097b.css integrity="sha256-R+K/UIvY0mCfUHUf7E6L6h19ZmRdCi+yXEpD9eysCXs=" crossorigin=anonymous media=screen><script src=https://www.metachris.dev/js/custom.js></script><link rel=stylesheet href=https://www.metachris.dev/scss/custom.min.24b6b5b956b5503f78b623a3e22f2f942491b071d48413705232bd54da07ad1e.css integrity="sha256-JLa1uVa1UD94tiOj4i8vlCSRsHHUhBNwUjK9VNoHrR4=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://www.metachris.dev/images/favicon-32px.png sizes=32x32><link rel=icon type=image/png href=https://www.metachris.dev/images/favicon-16px.png sizes=16x16><link rel=alternate type=application/rss+xml href=https://www.metachris.devindex.xml title="Site Title"></head><body class=colorscheme-auto><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://www.metachris.dev/>Chris Hager
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><svg width="20" height="20" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4A1 1 0 013 5zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/></svg></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://www.metachris.dev/posts/>Posts</a></li><li class=navigation-item><a class=navigation-link href=https://www.metachris.dev/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=https://www.metachris.dev/about/>About</a></li><li class=navigation-item><a id=dark-mode-toggle class=colorscheme-toggle title="Toggle light/dark theme" style=cursor:pointer><span id=theme-icon>ðŸŒ™</span></a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Securing private keys with a high-performance, threshold signature-based protocol</h1></div><div class=post-meta><div class=date><span class=posted-on><time datetime=2021-07-21T00:00:00Z>July 2021</time></span></div></div></header><div class=single-content><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://www.metachris.dev/js/load-photoswipe.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin=anonymous></script><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><p>This post is about the paper &ldquo;<em><a href=https://arxiv.org/pdf/2106.10972.pdf>Improving security for users of decentralized exchanges through multiparty computation</a></em>&rdquo;, by <a href=https://annessi.net/>Robert Annessi</a> and <a href=https://twitter.com/unignorant>Ethan Fast</a>.</p><p>The paper introduces an effective algorithm for secure, collaborative signature generation using threshold signatures, and an API-key based client/server protocol that allows user-specific limits and restrictions as well as key revocations and rotations.</p><p>The method supports all blockchains that use ECDSA and EdDSA signatures, which includes Bitcoin, Ethereum and the <a href=http://ethanfast.com/top-crypto.html>majority of popular cryptocurrencies</a>.</p><hr><p><strong>TLDR:</strong> Tired of dealing with private keys? Split it into two secret shares and require collaboration of two parties to generate the final signature, with neither party ever knowing the private key.</p><center class=fig1-wrap><link rel=stylesheet href=https://www.metachris.dev/css/hugo-easy-gallery.css><div class=box><figure class=fig1 itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img><img itemprop=thumbnail src=https://www.metachris.dev/images/posts/mpc/diag1.png alt="Cooperation flow for creating a signature"></div><a href=https://www.metachris.dev/images/posts/mpc/diag1.png itemprop=contentUrl></a><figcaption><p>Only the key generator has access to the private key</p></figcaption></figure></div></center><p>This setup allows any party to decline cooperation, providing a way to impose user-specific limits, restrictions and requirements for creating signatures, as well as the ability to permanently revoke keys.
For one private key, many unique pairs of secret shares can be generated (<a href="https://www.google.com/search?q=2+to+the+power+of+256">2<sup>256</sup></a> to be specific).</p><p>Secret shares can be created offline / airgapped as in the figure above, or as part of a trusted client or server, depending on your architecture and security profile.</p><p>This scheme can be used to secure existing addresses in most blockchains, and can be easily integrated into many applications that currently use private keys.</p><p>The costs of this approach (versus just using a private key) include a separate generation step for the secret shares (and possibly transfer onto client and server), required network connectivity between client and server, and stable server operations (because a client can&rsquo;t create signatures without a working server).</p><p>Malicious server software could decline cooperation, but transaction data cannot be modified and reach a valid final signature without agreement (signing) by the other party.</p><hr><p>Some areas of application:</p><ul><li>Applications that create signatures with private keys.</li><li>Backends and services that interact with blockchains, dapps and wallets.</li><li>Application-specific client interfaces and GUIs.</li><li>Hardware wallets like Ledger and Trezor (the private keys could reside on a separate device like a YubiKey).</li><li>Companies that want a more secure management of their private keys.</li></ul><hr><p>User-specific restrictions could include:</p><ul><li>Transaction details like amounts, recipients, data, &mldr;</li><li>User IP address or location.</li><li>Trading limits and market restrictions.</li><li>Withdrawal addresses and limits (even daily / weekly / monthly), time delayed withdrawals.</li><li>Allow access only from specific devices.</li><li>Biometric information such as a fingerprint scan.</li><li>Application-specific logic that can be checked on the server component (whatever can produce true or false as output).</li></ul><hr><h2 id=about-the-paper>About the paper</h2><p><a href=https://arxiv.org/pdf/2106.10972.pdf>The paper</a> presents an in-depth description of the scheme, cryptography and algorithms used, and provides a solid implementation blueprint. It comes with an <a href=https://github.com/nash-io/nash-rust/tree/master/mpc-wallet/nash-mpc>example implementation in Rust</a>.</p><p>Specifically the paper contains the following parts:</p><ul><li>Review and discussion of existing threshold signature algorithms</li><li>Improvements of existing 2-of-2 threshold signature algorithms, in particular Lindell&rsquo;s scheme.</li><li>Description of an API-key protocol that allows user-specific restrictions and limits, as well as key revocation and rotation.</li><li>Technical implementation guide for decentralized exchanges.</li><li>Description of the specific implementation at Nash.</li></ul><hr><h2 id=technical-details>Technical details</h2><p>The proposed algorithm is an optimized 2-of-2 threshold signature algorithm with significant improvements over <a href=https://eprint.iacr.org/2017/552>Lindell&rsquo;s scheme</a>. It supports ECDSA and EdDSA signatures.</p><p>The process includes two steps (phases):</p><ul><li><em>Preparation</em> - The private key is split into two multiplicative secret shares in advance, possibly airgapped, and transferred onto client and server.</li><li><em>Finalization</em> - Completing the signature (in a single message between client and server).</li></ul><p>Improvements over Lindell&rsquo;s scheme:</p><ul><li>Splitting the process into two steps, thereby reducing computational overhead at finalization and allowing airgapped generation of secret shares.</li><li>Finalization requires only a single message between client and server, and takes about 4ms (and network delay).</li><li>Lower message size:<ol><li>Preparation phase: 2x 33 B</li><li>Finalization phase: 545 B</li></ol></li><li>Lower storage overhead:<ul><li>On the server: 65 B per prepared point (33 B for the compressed point representation and 32 B for the serverâ€™s DH secret)</li><li>On the client: 321 B per prepared point (33 B for the compressed point representation, 32 B for the clientâ€™s DH secret, and 256 B for the Paillier randomness)</li></ul></li></ul><hr><h2 id=summary>Summary</h2><p>The authors present a novel, optimized cryptographic signing scheme which splits a private key into two secret shares and requires collaboration of two parties for creating a signature. The paper also introduces a server/client architecture with minimal communication overhead and API-key based credentials.
This setup allows implementation of user-specific limits and restrictions, as well as key revocations and rotations.</p><p>When creating the secret shares outside of client and server, at no point does any party have access to the private key or could create signatures without the other party collaborating. If one party is compromised, no signature can be created without the corresponding second secret share.</p><p>The paper includes a review of existing threshold signature schemes, specific improvements to Lindell&rsquo;s scheme, an api-key like signing setup, an implementation blueprint and an example implementation in Rust.</p><hr><h2 id=references>References</h2><ul><li>Paper: <a href=https://arxiv.org/pdf/2106.10972.pdf>https://arxiv.org/pdf/2106.10972.pdf</a> (<a href=https://ethresear.ch/t/improving-security-for-users-of-defi-services-dexs-through-mpc-threshold-signatures/10035>discussion on ethresear.ch</a>)</li><li>Code: <a href=https://github.com/nash-io/nash-rust/tree/master/mpc-wallet/nash-mpc>Reference implementation in Rust</a></li><li>Authors: <a href=https://annessi.net/>Robert Annessi</a> and <a href=https://twitter.com/unignorant>Ethan Fast</a>, <a href=https://nash.io/>Nash Exchange</a></li><li>Paper: <a href=https://eprint.iacr.org/2017/552>Fast Secure Two-Party ECDSA Signing</a> by Yehuda Lindell ("<em>Lindell&rsquo;s scheme</em>")</li><li>Post: <a href=http://ethanfast.com/top-crypto.html>Cryptography behind the top 100 cryptocurrencies</a></li><li>Post: <a href=https://blog.openmined.org/the-paillier-cryptosystem/>Paillier cryptosystem introduction</a></li></ul><hr><p>Thanks to Robert Annessi and Ethan Fast for reading drafts of this post.</p></div><hr><div class=subscribe-form><p>Enjoyed this post? Subscribe to get notified about new articles.</p><form action=https://buttondown.com/api/emails/embed-subscribe/metachris method=post target=_blank><input type=hidden name=tag value=metachris.dev/post>
<input type=email name=email placeholder=your@email.com required>
<button type=submit>Subscribe</button></form></div><hr><div style=float:right></div><div style=clear:both></div><div class=bottom-post-links><div class=prev><span class=title>PREVIOUS POST</span><br><a href=https://www.metachris.dev/2021/05/creating-go-bindings-for-ethereum-smart-contracts/>Creating Go Bindings for Ethereum Smart Contracts</a></div><div class=next><span class=title>NEXT POST</span><br><a href=https://www.metachris.dev/2022/12/running-geth-within-sgx-our-experience-learnings-and-code/>Running Geth within SGX: Our Experience, Learnings and Code</a></div></div><hr><footer><a id=comments></a><h2>Comments</h2><script src=https://utteranc.es/client.js repo=metachris/metachris.dev-comments issue-term=og:title theme=preferred-color-scheme crossorigin=anonymous async></script></footer></article></section></div><footer class=footer><section class=container></section></footer></main><script src=https://www.metachris.dev/js/dark-mode.min.6948493aa1da5fe4e63b34961a67cde1361353b72c9e2d61f024a34872147559.js></script><script defer src=https://cloud.umami.is/script.js data-website-id=5434b4c9-8ffe-4321-ad55-33012bbb5e73></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-168016633-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-168016633-1")</script></body></html>